<section class="dashboard" *ngIf="user(); else guestView">
  <div class="row align-items-center mb-4">
    <div class="col-md-8">
      <div>
        <h1 class="h3 mb-1">{{ welcomeMessage() }}</h1>
        <p class="text-muted mb-0">Logged in as <strong>{{ user()?.fullname }}</strong> ({{ user()?.email }})</p>
      </div>
    </div>
    <div class="col-md-4 text-md-end mt-3 mt-md-0">
      <div class="student-card p-3 rounded shadow-sm">
        <p class="fw-semibold mb-1">Student: {{ studentName }}</p>
        <p class="text-muted mb-0">ID: {{ studentId }}</p>
      </div>
    </div>
  </div>

  <div class="row g-3 mb-4" *ngIf="stats$ | async as stats">
    <div class="col-12 col-md-6 col-lg-3" *ngFor="let card of [
      { title: 'Total Recipes', value: stats.recipeCount, icon: '🍽️', variant: 'recipes' },
      { title: 'Inventory Items', value: stats.inventoryCount, icon: '📦', variant: 'inventory' },
      { title: 'Registered Users', value: stats.userCount, icon: '👥', variant: 'users' },
      { title: 'Cuisine Variety', value: stats.cuisineCount, icon: '🌍', variant: 'cuisine' }
    ]">
      <div class="card shadow-sm h-100 border-0" [ngClass]="'card-' + card.variant">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="icon-circle me-3">{{ card.icon }}</div>
            <div>
              <p class="text-uppercase small mb-1">{{ card.title }}</p>
              <h3 class="mb-0">{{ card.value }}</h3>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-12 col-md-6 col-lg-3">
      <div class="card shadow-sm h-100 border-0 card-value">
        <div class="card-body">
          <p class="text-uppercase small mb-1">Inventory Value</p>
          <h3 class="mb-0">{{ stats.inventoryValue | currency:'USD':'symbol' }}</h3>
          <p class="text-muted mb-0 small">Based on current inventory records.</p>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-3">
    <div class="col-12 col-lg-6">
      <div class="card h-100 shadow-sm">
        <div class="card-body">
          <h2 class="h5 card-title">Quick Actions</h2>
          <p class="text-muted">Shortcuts to help you get things done faster.</p>
          <div class="list-group list-group-flush">
            <a
              *ngFor="let action of quickActions"
              class="list-group-item list-group-item-action d-flex justify-content-between align-items-start"
              [routerLink]="action.useRouter ? action.link : undefined"
              [attr.href]="action.useRouter ? null : action.link"
              [attr.target]="action.useRouter ? null : '_blank'"
              rel="noopener"
            >
              <div>
                <div class="fw-semibold">{{ action.label }}</div>
                <small class="text-muted">{{ action.description }}</small>
              </div>
              <span class="badge bg-{{ action.variant }} rounded-pill">Go</span>
            </a>
          </div>
        </div>
      </div>
    </div>

    <div class="col-12 col-lg-6">
      <div class="card h-100 shadow-sm">
        <div class="card-body">
          <h2 class="h5 card-title">System Health</h2>
          <p class="text-muted">Recipe Hub keeps data fresh every 30 seconds. Latest update reflects the information above.</p>
          <ul class="list-unstyled mb-0">
            <li class="d-flex align-items-center mb-3">
              <span class="status-indicator bg-success me-2"></span>
              <span>Database connection active</span>
            </li>
            <li class="d-flex align-items-center mb-3">
              <span class="status-indicator bg-success me-2"></span>
              <span>Recipe synchronization up to date</span>
            </li>
            <li class="d-flex align-items-center">
              <span class="status-indicator bg-success me-2"></span>
              <span>Inventory monitoring operational</span>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</section>

<ng-template #guestView>
  <div class="card shadow-sm">
    <div class="card-body text-center">
      <img [src]="logoUrl" alt="Recipe Hub Custom Logo" class="dashboard-logo mb-3" />
      <h2 class="h4">Welcome to Recipe Hub</h2>
      <p class="text-muted">Please log in to see your personalized dashboard.</p>
      <a routerLink="/login" class="btn btn-primary">Go to Login</a>
    </div>
  </div>
</ng-template>
