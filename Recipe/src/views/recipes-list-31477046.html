<!doctype html>
<!-- Tabular overview of all recipes accessible to the current user. -->
<html lang="en" data-bs-theme="auto">
  <head>
    <meta charset="utf-8" />
    <title>Recipes - List</title>
    <link rel="stylesheet" href="/bootstrap.min.css" />
    <link rel="stylesheet" href="/pages.css" />
  </head>
  <body class="recipes-list-page">
    <div class="container">
      <div class="mb-3">
        <!-- Keep navigation consistent with the rest of the app. -->
        <a class="btn btn-outline-primary" href="/home-<%= appId %>?userId=<%= userId %>">Return to Home</a>
      </div>

      <% if (typeof msg !== 'undefined' && msg) { %>
        <!-- Success banner for CRUD operations. -->
        <div class="alert alert-success mb-4"><%= msg %></div>
      <% } %>
      <h1 class="text-center mb-1">All Recipes</h1>
      <p class="text-center text-muted mb-4">Discover and manage your culinary collection</p>
      <div class="d-flex justify-content-between align-items-center mb-3">
        <a class="btn btn-primary" href="/add-recipe-<%= appId %>?userId=<%= userId %>">Add New Recipe</a>
        <span class="badge bg-secondary"><%= recipes ? recipes.length : 0 %> recipes</span>
      </div>

      <% if (!recipes || recipes.length === 0) { %>
        <div class="alert alert-info">No recipes yet. Try adding one.</div>
      <% } else { %>
        <div class="table-responsive">
          <table class="table table-striped table-bordered align-middle">
            <thead class="table-light">
              <tr>
                <th>Recipe ID</th>
                <th>Title</th>
                <th>Meal Type</th>
                <th>Cuisine</th>
                <th class="mono">Prep (mins)</th>
                <th>Difficulty</th>
                <th class="mono">Servings</th>
                <th>Chef</th>
                <th>Created</th>
                <th>Ingredients</th>
                <th>Instructions</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
            <!-- Walk each recipe and prepare strings for display. -->
            <% for (let i = 0; i < recipes.length; i++) {
                 const r = recipes[i];
                 let ingLines = [];
                 if (Array.isArray(r.ingredients)) {
                   for (let j = 0; j < r.ingredients.length; j++) {
                     const ing = r.ingredients[j] || {};
                     ingLines.push((ing.ingredientName || '') + ' ' + (ing.quantity || '') + ' ' + (ing.unit || ''));
                   }
                 }
                 let stepLines = [];
                 if (Array.isArray(r.instructions)) {
                   for (let k = 0; k < r.instructions.length; k++) {
                     if (r.instructions[k]) stepLines.push((k+1) + '. ' + r.instructions[k]);
                   }
                 }
                 let diffClass = 'bg-secondary';
                 if (r.difficulty === 'Easy') { diffClass = 'bg-success'; }
                 else if (r.difficulty === 'Medium') { diffClass = 'bg-warning text-dark'; }
                 else if (r.difficulty === 'Hard') { diffClass = 'bg-danger'; }
            %>
              <tr>
                <td class="mono"><%= r.recipeId %></td>
                <td><%= r.title %></td>
                <td><%= r.mealType %></td>
                <td><%= r.cuisineType %></td>
                <td class="mono"><%= r.prepTime %></td>
                <td><span class="badge <%= diffClass %>"><%= r.difficulty %></span></td>
                <td class="mono"><%= r.servings %></td>
                <td><%= r.chef %></td>
                <td class="mono"><%= r.createdDate %></td>
                <td><pre><%= ingLines.join('\n') %></pre></td>
                <td><pre><%= stepLines.join('\n') %></pre></td>
                <td>
                  <a class="btn btn-sm btn-secondary mb-1" href="/edit-recipe-<%= appId %>?userId=<%= userId %>&recipeId=<%= r.recipeId %>">Edit</a>
                  <form
                    method="post"
                    action="/delete-recipe-<%= appId %>"
                    class="d-inline"
                    onsubmit="return confirm('Delete recipe <%= r.recipeId %>?');"
                  >
                    <input type="hidden" name="recipeId" value="<%= r.recipeId %>" />
                    <input type="hidden" name="userId" value="<%= userId %>" />
                    <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                  </form>
                </td>
              </tr>
            <% } %>
            </tbody>
          </table>
        </div>
      <% } %>
    </div>

  </body>
</html>






